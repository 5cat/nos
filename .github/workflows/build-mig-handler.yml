  on:
    workflow_dispatch:
      inputs:
        docker-image:
          description: 'The name of the docker image that will be build'
          required: true
          default: 'migagent:latest'
          type: string

  env:
    REGISTRY: ghcr.io
    IMAGE_NAME: "${{ github.repository }}-migagent:latest"

  jobs:
    docker:
      runs-on: ubuntu-22.04
      permissions:
        contents: read
        packages: write
      steps:
        - name: Checkout repository
          uses: actions/checkout@v3

        - name: Login to DockerHub
          uses: docker/login-action@v2
          with:
            registry: ${{ env.REGISTRY }}
            username: ${{ github.actor }}
            password: ${{ secrets.GITHUB_TOKEN }}

        - name: Build and push
          uses: docker/build-push-action@v3
          with:
            context: .
            push: true
            file: build/migagent/Dockerfile
            tags: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}