  on:
    workflow_dispatch:
      inputs:
        docker-image:
          description: 'The name of the docker image that will be build'
          required: true
          default: 'migagent:latest'
          type: string

  env:
    REGISTRY: ghcr.io
    #    IMAGE_NAME: "${{ github.repository }}-migagent:latest"
    CONTROLLER_IMG: "${{ github.repository }}-controller:latest"
    SCHEDULER_IMG: "${{ github.repository }}-scheduler:latest"
    MIGAGENT_IMG: "${{ github.repository }}-migagent:latest"
    GPU_PARTITIONER_IMG: "${{ github.repository }}-gpu-partitioner:latest"

  jobs:
    docker-build:
      runs-on: ubuntu-22.04
      permissions:
        contents: read
        packages: write
      steps:
        - name: Checkout repository
          uses: actions/checkout@v3

        - name: Login to DockerHub
          uses: docker/login-action@v2
          with:
            registry: ${{ env.REGISTRY }}
            username: ${{ github.actor }}
            password: ${{ secrets.GITHUB_TOKEN }}

        - name: Build images
          run: make docker-build

        - name: Push images
          run: make docker-push
  #          uses: docker/build-push-action@v3
  #          with:
  #            context: .
  #            push: true
  #            file: build/migagent/Dockerfile
  #            tags: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}